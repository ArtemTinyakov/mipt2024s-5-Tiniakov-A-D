# In Zone Instance Segmentation

-----------------------------------------

### Существующие State Of The Art решения для сегментации баркодов

##### 1. [Yolo](https://github.com/ultralytics/ultralytics)
   Протестирована Yolov8n Segmentation. Сеть легко обучать прямо из консоли (ultralytics предоставляет пакет yola делающий использование новых версий особенно удобным). Модель обучалась на очень маленьком датасете (собранном мной вручную, было всего около 30 изображений). Проверить инференс обученной модели также можно просто из консоли, модель проверялась на видео с вебкамеры. Несмотря на то, что модель обучалась на очень маленьком датасете, она смогла распознать баркод в некоторых ситуациях (но в основном конечно нет). (пруф не выкладываю пока, потому что удалил модель и графики с обучения и результаты инференса, выложу позже)

##### 2. [OpenCV BarcodeDetector](https://docs.opencv.org/4.x/dc/df7/classcv_1_1barcode_1_1BarcodeDetector.html)
  Протестирована модель детекции (к сожалению OpenCV не предоставляет сегментационную сетку, но возможно это исправимо если потребуется) баркодов из OpenCV. Есть туториал прямо в документации OpenCV, модель предоставляется уже обученной (данный детектор только на 1d баркоды). Качество детекции отвратительное, получилось распознать штрихкоды только на прямом контрастном изображении, небольшие искажения приводят к недееспособности модели.
![barcodes](https://github.com/ArtemTinyakov/mipt2024s-5-Tiniakov-A-D/assets/53254660/672a9f81-4a03-4e12-9a7b-09e98f075aae)
![barcode_opencv](https://github.com/ArtemTinyakov/mipt2024s-5-Tiniakov-A-D/assets/53254660/8c822803-3728-4648-97e1-fa4215942921)

##### 3. [ZBar BarcodeDetector](https://github.com/mchehab/zbar)
  Протестирована модель детекции (сегментационная сеть от zbar не нашлась) баркодов от ZBar (pyzbar для python). Туториал по запуску готовой модели легко находится в гугле, используется предобученная модель из модуля. Качество детекции схоже с детектором из OpenCV - такое же отвратительное, малейшие искажения приводят к невозможности детекции, однако заявляется, что эта модель находит и 1d и 2d баркоды.
![barcodes](https://github.com/ArtemTinyakov/mipt2024s-5-Tiniakov-A-D/assets/53254660/8d819099-492a-4f44-9d16-47ea80ebaea8)
![barcode_pyzbar](https://github.com/ArtemTinyakov/mipt2024s-5-Tiniakov-A-D/assets/53254660/b968d645-30cb-48b6-b4b3-023b4fc47891)

Работа над поиском SOTA решений продолжается, на данный момент можно сделать следующие выводы:
- модель yolo от ultralytics показывает себя неплохо, однако слишком тяжелая для развертывания на мобильных устройствах;
- детекторы от OpenCV и ZBar использовать не представляется возможным, качество детекции отвратительное;
- вероятно придется разрабатывать собственную модель с нуля (возможно опираясь на опыт ultralytics).

Проверять результаты моделей можно по различным метрикам, например P-R. Также имеет смысл отрисовывать сегментационную маску на исходном изображении и проверять глазами качество сегментации.

Endpoints:
- на вход можно принимать любые изображения в определенном цветовом пространстве (например RGB), а также файлы с разметкой, соответствующие файлам с изображениями;
- на выходе модель будет выдавать сегментационную маску, на которой объекты разных меток будут отрисованы разным цветом.

Продемонстрировать результаты можно например направив видеопоток с вебкамеры (или из заранее приготовленного видео) в скрипт с предобработкой потока, разбиением его на кадры и т.п., накладыванием на кадры сегментационную маску и выводом в файл/на экран. Также необходимо строить графики с метриками эволюции модели (например P-R для каждой итерации обучения, а также график наилучших P-R для разных моделей).
